<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title></title>
	<script type="text/javascript" src="../../js/jquery-1.10.2.min.js"></script>
	<link rel="stylesheet" href="../template/bootstrap/bootstrap.css">
	<script src="../template/bootstrap/bootstrap.js"></script>
	<script type="text/javascript" src="../../script/api.js"></script>
	  <script src="../../js/cookie.js"></script>
		<script src="viewer-jquery.min.js"></script>
<link rel="stylesheet" href="viewer.min.css" media="all"/>
</head>
<style type="text/css">
	.form-horizontal .form-group {
		margin: 0;
		margin-top: 15px;
	}

	.btn_position {
		width: 50%;
		display: flex;
		justify-content: center;
		align-items: center;
		margin: 0 auto;
		margin-bottom: 15px;
	}

	.btn_position div {
		width: 200px;
		display: flex;
		justify-content: space-around;
		align-items: center;
	}

	header {
		height: 50px;
		width: 100%;
		background: url(../../images/navbar.png);
		color: #f1f1f1;
		text-shadow: 1px 1px 3px #000;
	}

	h4 {
		color: #f1f1f1;
		text-shadow: 1px 1px 3px #000;
	}

	header div {
		margin-left: 15px;
		width: 56%;
		height: 100%;
		display: flex;
		align-items: center;
		justify-content: space-between;
		font-size: 14px;
	}

	header img {
		width: 17px;
		height: 17;
	}

	header span {
		width: 40px;
		height: 100%;
		display: flex;
		align-items: center;
	}

	#img_father {
		display: none;
	}

	#video_father {
		display: none;
	}

	#audio_father {
		display: none;
	}

	#img img {
		width: 180px;
		height: 120px;
	}
	#file_father{
		display: none;
}
#pdf_father{
		display: none;
}
.button{
		margin: 0;
}
#file{
		display: flex;
		align-items: flex-end;
}
.margin{
		margin-top: 5px;
		margin-left: 15px;
		font-size: 12px;
}
</style>

<body>
	<header>
		<div>
			<span tapmode onclick="comeBack()"><img src="../../images/fh.svg" alt="" ></span>
			<h4>履责记录</h4>
		</div>
	</header>
	<form class="form-horizontal">
		<div class="form-group">
			<label for="user" class="col-sm-2 col-md-2 col-lg-1 control-label ">岗位</label>
			<div class="col-sm-4">
				<input type="text" class="form-control" disabled id="post" placeholder="">
			</div>
		</div>
		<div class="form-group">
			<label for="user" class="col-sm-2 col-md-2 col-lg-1 control-label ">标题</label>
			<div class="col-sm-4">
				<input type="text" class="form-control" id="tz_title" disabled placeholder="">
			</div>
		</div>
		<div class="form-group">
			<label for="user" class="col-sm-2 col-md-2 col-lg-1 control-label">执行时间</label>
			<div class="col-sm-4">
				<input type="text" class="form-control" id="endtime" disabled placeholder="">
			</div>
		</div>

		<div class="form-group">
			<label for="name" class="col-sm-2 col-md-2 col-lg-1 control-label ">情况记录</label>
			<div class="col-sm-4">
				<textarea class="form-control" rows="5" disabled id="content"></textarea>
			</div>

		</div>
		<div class="form-group">
			<label for="name" class="col-sm-2 col-md-2 col-lg-1 control-label ">相关建议</label>
			<div class="col-sm-4">
				<textarea class="form-control" rows="5" disabled id="jl"></textarea>
			</div>
		</div>
		<div class="form-group" id="img_father">
			<label for="name" class="col-sm-2 col-md-2 col-lg-1 control-label ">图片预览</label>
			<div id="img" style="margin-left:14px;">

			</div>
		</div>
		<div class="layui-form-item" id="file_father">
        <label class="col-sm-2 col-md-2 col-lg-1 control-label">文件预览</label>
        <div class="layui-input-block" id="file">

        </div>
    </div>
    <div class="layui-form-item" id="pdf_father">
        <label class="col-sm-2 col-md-2 col-lg-1 control-label">文件预览</label>
        <div class="layui-input-block" id="pdf">

        </div>
    </div>
		<div class="form-group" id="video_father">
			<label for="name" class="col-sm-2 col-md-2 col-lg-1 control-label ">视频</label>
			<div>
				<video src="" id="video" style="width: 300px;height: 200px"></video>
			</div>
		</div>
		<div class="form-group" id="audio_father">
			<label for="name" class="col-sm-2 col-md-2 col-lg-1 control-label ">录音</label>
			<div>
				<audio src="" id="audio" style="width: 300px;height: 60px"></audio>
			</div>
		</div>

		<div class="form-group">
			<label for="" class="col-sm-2 col-md-2 col-lg-1 control-label">难易程度</label>
			<div class="col-sm-5  col-md-4" id="grade">
				<label class="radio-inline">
        <input type="radio" name="work_grade" value="1" checked> A级任务
      </label>
				<label class="radio-inline">
        <input type="radio" name="work_grade"  value="2"  > B级任务
      </label>
				<label class="radio-inline">
        <input type="radio" name="work_grade"  value="3"  > C级任务
      </label>
			</div>
		</div>
		<div class="form-group">
			<label for="user" class="col-sm-2 col-md-2 col-lg-1 control-label">该次满分</label>
			<div class="col-sm-4">
				<input type="text" class="form-control" id="score" disabled placeholder="">
			</div>
		</div>

		<div class="form-group">
			<label for="user" class="col-sm-2 col-md-2 col-lg-1 control-label" id="bz">预计得分</label>
			<div class="col-sm-4">
				<input type="text" class="form-control" id="zp_score" placeholder="">
			</div>
		</div>

		<div class="form-group">
			<label for="template" class="col-sm-2 col-md-2 col-lg-1 control-label">合格等级</label>
			<div class="col-sm-4">
				<select class="form-control" name="grade" class="grade">
            <option value='1'>完全合格</option>
              <option value='2'>部分不合格</option>
              <option value='3'>完全不合格</option>
        </select>
			</div>
		</div>

		<div class="form-group">
			<label for="name" class="col-sm-2 col-md-2 col-lg-1 control-label">打分说明</label>
			<div class="col-sm-4">
				<textarea class="form-control" rows="5" id="basis"></textarea>
			</div>

		</div>

		<input type="hidden" id="tz_id" value=''>
		<div style="height:20px"></div>
		<div class="btn_position">
			<div>
				<button type="button" class="btn btn-info" tapmode id="sub">提交</button>
				<button type="reset" class="btn btn-danger">重置</button>
			</div>
		</div>
	</form>
</body>
<script>
	apiready = function() {
		id = api.pageParam.id;
		ip = localStorage.getItem("ip")
		url = `http://${ip}/dutylist/src/taizhang.php`
		$.ajax({
			type: "POST",
			url: url,
			dataType: 'json',
			data: {
				id: id,
				user_id:$.cookie('user_id')
			},
			success: function(data) {
		  var img1=''
			var word=''
			var pdf=''
			var url='http://118.25.5.116/dutylist/src/images/'
			$.each(data.action,function (index,value) {
				var file=/\.[^\.]+$/.exec(value.fil_path);
				if(file[0]=='.png'||file[0]=='.jpg'||file[0]=='.jpeg'){
						var file_name=value.fil_path.replace(/(.*\/)*([^.]+).*/ig,"$2");
						img1+= `<img src='${url}${file_name}${file[0]}' class='img' style='width: 150px' height='100px'>`
					}
				if(file[0]=='.xlsx'||file[0]=='.docx'){
					var file_name=value.fil_path.replace(/(.*\/)*([^.]+).*/ig,"$2");
					word+=`<a href="http://www.xdocin.com/xdoc?_func=to&amp;_format=html&amp;_cache=1&amp;_xdoc=${url}${file_name}${file[0]}" target="_blank" rel="nofollow" class="btn btn-info margin">查看文件</a>`
				}
				if(file[0]=='.pdf'){
					var file_name=value.fil_path.replace(/(.*\/)*([^.]+).*/ig,"$2");
					pdf+=`<a href="${url}${file_name}${file[0]}" class="btn btn-info margin">查看文件</a>`
				}

			})
					// console.log(data);
				$("#post").val(data.post_name);
				$("#title").val(data.title);
				$("#tz_title").val(data.title);
				$("#endtime").val(data.subtime);
				$("#content").val(data.content);
				$("#jl").val(data.jianyi);
				$("#score").val(data.score);
				$("#tz_id").val(data.id);
				$("#zp_score").val(data.zp_score)
				if (data.grade == 1) {
					$("#a").attr("checked", "checked");
				} else if (data.grade == 2) {
					$("#b").attr("checked", "checked");
				} else if (data.grade == 3) {
					$("#c").attr("checked", "checked");
				}
				// layui.form.render();

				  $('#img').html(img1);
					$('#file').html(word)
					$('#pdf').html(pdf)
					if(pdf){
						$('#pdf_father').show()
					}
					if(word){
						$('#file_father').show()
					}
				// $('#video').attr('src',)
				// $('#audio').attr('src',)
				var img = $('.img').attr('src')
				var video = $('#video').attr('src')
				var audio = $('#audio').attr('src')
				if (img) {
					$('#img_father').show()
				}
				if (video) {
					$('#video_father').show()
				}
				if (audio) {
					$('#audio_father').show()
				}
				$('#img_father').viewer({
				url: 'src',
			});
			}
		})


	}


	$("#sub").click(function() {
		ip = localStorage.getItem("ip")
		let url = `http://${ip}/dutylist/src/shenghe.php`
		console.log(url)
		var id = $('#tz_id').val();
		var num = $('#zp_score').val()
		var basis = $("#basis").val()
		$.ajax({
			type: 'POST',
			url: url,
			dataType: 'json',
			data: {
				id: id,
				num: num,
				basis: basis
			},
			success: function(res) {
				if (res == 200) {
					alert("审核成功！");
				} else if (res == 300) {
					alert("已审核！");
				} else {
					alert("审核失败！");
				}

			}
		})
	})


	function comeBack() {   
		api.historyBack({  }, function(ret, err) {     
			if (!ret.status) {       
				api.closeWin();     
			}  
		});
	}
</script>

</html>
